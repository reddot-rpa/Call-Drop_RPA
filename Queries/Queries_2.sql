DELETE FROM CALL_DROP_FILE_LOG 
WHERE FILE_NAME='call_drop_rebate_postpaid_20220831_1.xlsx';

SELECT * FROM CALL_DROP_SMS_LOG_AIRTEL
WHERE MSISDN in ('8801616519464','8801616815429','8801618866747','8801626322160','8801622747970','8801625233541') AND FILE_NAME in ('call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv');

UPDATE CALL_DROP_SMS_LOG_AIRTEL 
SET SMS_STATUS = 'Sent' 
WHERE FILE_NAME IN ('call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv','call_drop_air_rebate_prepaid_20220829_2.csv') 
AND MSISDN IN ('8801616519464','8801616815429','8801618866747','8801626322160','8801622747970','8801625233541')

UPDATE CALL_DROP_FILE_LOG  
SET STATUS = 'DUMP'  
WHERE FILE_NAME in ('call_drop_air_rebate_prepaid_20220829_1.xlsx', 'call_drop_air_rebate_prepaid_20220829_2.xlsx');

select Count(*) from CALL_DROP_SMS_LOG_ROBI
where FILE_NAME LIKE '%20221004_76%'

Select MSISDN, AMOUNT, SMS_STATUS, CREATE_TIME
From CALL_DROP_SMS_LOG_ROBI
where MSISDN in ('8801821682206', '8801755521889', '8801810029419', '8801978154745') and TRUNC(CREATE_TIME)=TO_DATE('02-JUL-2022')
Order By CREATE_TIME DESC

Select MSISDN, AMOUNT, SMS_STATUS, CREATE_TIME
From CALL_DROP_SMS_LOG_AIRTEL
where MSISDN in ('8801609462313', '8801600324087') and TRUNC(CREATE_TIME)=TO_DATE('02-JUL-2022')
Order By CREATE_TIME DESC

SELECT * FROM CALL_DROP_FILE_LOG WHERE BRAND='Robi' AND FILE_NAME LIKE '%20221005%' ORDER BY CASE STATUS WHEN 'Pending' THEN 1 WHEN 'Upload Complete' THEN 2 WHEN 'Download Complete' THEN 3 ELSE 4 END


SELECT COUNT(*) FROM CALL_DROP_FILE_LOG WHERE FILE_NAME like '%20221016%';

Select Count(*)
From CALL_DROP_FILE_LOG
where STATUS != 'Done'

SELECT * FROM CALL_DROP_FILE_LOG 
WHERE STATUS='Done' 
Order By CREATE_TIME DESC

SELECT MSISDN, COUNT(MSISDN)
FROM CALL_DROP_SMS_LOG_ROBI
WHERE FILE_NAME LIKE '%call_drop_rebate_prepaid_20221006_19%'
GROUP BY MSISDN
HAVING COUNT(MSISDN) > 1

SELECT COUNT(*) FROM CALL_DROP_SMS_LOG_ROBI
WHERE FILE_NAME LIKE '%call_drop_rebate_prepaid_20221006_19%'

SELECT * FROM CALL_DROP_SMS_LOG_AIRTEL
WHERE MSISDN = '8801608763103'

SELECT * FROM CALL_DROP_SMS_LOG_ROBI WHERE SMS_STATUS='Pending' FETCH NEXT 1000 ROWS ONLY

Select Count(*)
From CALL_DROP_SMS_LOG_ROBI
where SMS_STATUS = 'Pending'

Select Count(*)
From CALL_DROP_SMS_LOG_AIRTEL
where SMS_STATUS = 'Pending'

Select Count(*)
From CALL_DROP_SMS_LOG_AIRTEL
where FILE_NAME like '%20221003%';

DELETE FROM CALL_DROP_FILE_LOG where FILE_NAME like 'uat%' and STATUS = 'Pending';

SELECT COUNT(*)
FROM CALL_DROP_SMS_LOG_ROBI
WHERE FILE_NAME = 'call_drop_rebate_postpaid_20221003_1.csv'


Select Count(*)
From CALL_DROP_SMS_LOG_AIRTEL
where EFF_DATE like '20221004%'

Select Count(*)
From CALL_DROP_SMS_LOG_ROBI
where FILE_NAME like 'call_drop_%_20221002%'


SELECT TRANSDATE
,SUM( CASE WHEN BRAND='ROBI' THEN SMS_COUNT ELSE 0 END ) ROBI_SMS_COUNT
,SUM( CASE WHEN BRAND='AIRTEL' THEN SMS_COUNT ELSE 0 END ) AIRTEL_SMS_COUNT
,( SUM( CASE WHEN BRAND='ROBI' THEN SMS_COUNT ELSE 0 END ) + SUM( CASE WHEN BRAND='AIRTEL' THEN SMS_COUNT ELSE 0 END )
) TOAL_SMS_COUNT
FROM (
SELECT TRUNC(CREATE_TIME) TRANSDATE, 'ROBI' BRAND ,COUNT(*) SMS_COUNT
FROM CALL_DROP_SMS_LOG_ROBI
WHERE TRUNC(CREATE_TIME)>=TO_DATE('02-SEP-2022') AND TRUNC(CREATE_TIME)<=TO_DATE('01-OCT-2022')
GROUP BY TRUNC(CREATE_TIME)
UNION ALL
SELECT TRUNC(CREATE_TIME) TRANSDATE, 'AIRTEL' BRAND ,COUNT(*) SMS_COUNT
FROM CALL_DROP_SMS_LOG_AIRTEL
WHERE TRUNC(CREATE_TIME)>=TO_DATE('02-SEP-2022') AND TRUNC(CREATE_TIME)<=TO_DATE('01-OCT-2022')
GROUP BY TRUNC(CREATE_TIME)
)
GROUP BY TRANSDATE
ORDER BY TRANSDATE;

SELECT * FROM CALL_DROP_SMS_LOG_ROBI WHERE SMS_STATUS = 'Pending' FETCH NEXT 1000 ROWS ONLY


